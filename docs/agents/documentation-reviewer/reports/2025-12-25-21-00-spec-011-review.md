# Documentation Review Report - SPEC-011-frontend-auth.md

**Date**: 2025-12-25 21:00
**Reviewer**: Documentation Reviewer Agent
**Specification**: `community/docs/specifications/SPEC-011-frontend-auth.md`
**Status**: Draft

---

## Kontekst

- **Specyfikacja**: SPEC-011: Frontend - Auth (2025-12-24)
- **Status specyfikacji**: Draft
- **Produkty dotkniÄ™te**: `community/apps/web` (React frontend)
- **ADR sprawdzone**:
  - ADR-2025-12-25-signed-urls-for-public-files.md (nie dotyczy auth)
  - ADR-2025-12-25-api-port-change-to-6200.md (nie dotyczy auth)
  - Brak ADR dla frontend stack selection

---

## Podsumowanie wykonania

### Realizacja specyfikacji: PARTIAL (60%)

**Zrealizowane**:
- Login page z formularzem email/password
- Podstawowa struktura auth (AuthProvider, useAuth hook)
- Protected routes z ProtectedRoute component
- JWT storage (localStorage, nie HTTP-only cookies jak w spec)
- API client z refresh interceptor
- Routing z React Router

**Niezrealizowane / Odchylenia**:
- Brak Register page (tylko Login)
- Brak Forgot Password flow (zaplanowane v2)
- Backend uÅ¼ywa HTTP-only cookies, frontend localStorage (CRITICAL security mismatch)
- Brak React Hook Form + Zod validation (tylko HTML5 validation)
- Brak testÃ³w (naruszenie TDD requirement z CLAUDE.md)
- Struktura nie zgodna z Clean Architecture (logika w komponentach)

---

## 1. Struktura specyfikacji

### Ocena: DOBRZE (85%)

**Zalety**:
- Jasno zdefiniowany cel biznesowy (MVP auth flow)
- User stories okreÅ›lone (login, register, session management)
- Stack technologiczny szczegÃ³Å‚owo opisany
- Implementacja z przykÅ‚adami kodu (AuthContext, LoginForm, API client)
- UI/UX mockupy (Login page)
- Definition of Done z checklistami

**Braki**:
- Brak wyraÅºnego out-of-scope (co NIE wchodzi)
- Brak edge cases (co jeÅ›li token expired podczas uÅ¼ycia?)
- Brak error scenarios (network errors, 5xx, rate limiting)
- Brak migration plan (jak upgrade existing sessions?)

**Sugestie**:

```markdown
## Out of Scope (v1)
- Password reset / forgot password (v2)
- 2FA / MFA
- Social login (Google, GitHub)
- Remember me persistence (session length control)
- Concurrent session management
```

---

## 2. Technical Design

### Ocena: UMIARKOWANIE (60%)

#### Brak backend API specification

**CRITICAL MISSING**:
Specyfikacja nie definiuje backend API contracts, mimo Å¼e w rozdziale 4.2 i 4.3 sÄ… przykÅ‚ady wywoÅ‚aÅ„ API:

- `POST /auth/login`
- `POST /auth/register`
- `POST /auth/logout`
- `POST /auth/refresh`
- `GET /auth/me`

**Problem**:
- Brak request/response schema
- Brak status codes (201 vs 200, 409 vs 400)
- Brak error response format
- Brak token expiration times
- Brak workspace creation flow (po rejestracji?)

**Rzeczywisty backend API** (z `apps/api/src/interfaces/http/auth.controller.ts`):

```typescript
POST /auth/register
Request: { email, password, name? }
Response: { message, user: { id, email, name } }
Cookies: access_token (15min), refresh_token (7d)

POST /auth/login
Request: { email, password }
Response: { message, user: { id, email, name } }
Cookies: access_token (15min), refresh_token (7d)

POST /auth/logout
Response: { message }
Side-effect: Clear cookies

POST /auth/refresh
Request: { refresh_token }
Response: { message }
Cookies: New access_token, refresh_token
```

**BRAK** endpoint `GET /auth/me` w backendzie - specyfikacja zakÅ‚ada jego istnienie (linia 137-143), ale nie zostaÅ‚ zaimplementowany!

**Jak poprawiÄ‡ specyfikacjÄ™**:

DodaÄ‡ rozdziaÅ‚:

```markdown
## 5. Backend API Contracts

### 5.1 Authentication Endpoints

#### POST /auth/register

**Request:**
```json
{
  "email": "user@example.com",
  "password": "MyP@ssw0rd!",  // Min 12 chars, uppercase, lowercase, number, special
  "name": "John Doe"          // Optional
}
```

**Response 201 Created:**
```json
{
  "message": "Registration successful",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "John Doe"
  }
}
```

**Cookies Set:**
- `access_token` (HttpOnly, Secure, SameSite=Strict, 15min)
- `refresh_token` (HttpOnly, Secure, SameSite=Strict, 7d)

**Error 409 Conflict:**
```json
{
  "statusCode": 409,
  "message": "Email already registered",
  "error": "Conflict"
}
```

#### GET /auth/me (MISSING IN BACKEND)

**Status**: Not implemented - specyfikacja wymaga, backend nie ma

**Expected:**
```
GET /auth/me
Authorization: Bearer {access_token}

Response 200:
{
  "id": "uuid",
  "email": "user@example.com",
  "name": "John Doe"
}
```

**Required for**: Session check on mount (AuthContext line 131-143)
```

---

#### Brak email templates

**MISSING**:
Specyfikacja nie definiuje email templates dla:
- Welcome email po rejestracji
- Email verification (jeÅ›li wymagane)
- Password reset (v2, ale warto zdefiniowaÄ‡ format teraz)

**Pytania bez odpowiedzi**:
- Czy email verification jest wymagane przed login?
- Czy rejestracja wymaga potwierdzenia emaila?
- Czy backend wysyÅ‚a powitalnego emaila?

**Sugestia**: DodaÄ‡ rozdziaÅ‚ lub wyraÅºnie zaznaczyÄ‡ "no email verification for v1 MVP".

---

#### Brak workspace creation flow

**CRITICAL MISSING**:
Po rejestracji uÅ¼ytkownik potrzebuje workspace (wedÅ‚ug `apps/web/src/features/dashboard/Dashboard.tsx` - pokazuje listÄ™ workspaces).

**Pytania**:
1. Czy backend automatycznie tworzy default workspace przy rejestracji?
2. Czy frontend musi wywoÅ‚aÄ‡ `POST /workspaces` po register?
3. Jak nazywa siÄ™ ten workspace? ("My Workspace", "username's workspace"?)
4. Czy jest limit workspace per user (SPEC-003)?

**Brak w specyfikacji**:

```markdown
### 2.3 Post-Registration Flow

After successful registration:
1. Backend creates default workspace: `{name}\'s Workspace`
2. User automatically added as workspace owner
3. Frontend redirects to /dashboard
4. Dashboard displays the default workspace

Endpoint: `POST /auth/register` handles workspace creation internally.
```

**Rzeczywisty backend** prawdopodobnie NIE tworzy workspace automatycznie (brak w auth.controller.ts).

---

#### Brak Mailpit/email configuration

**MISSING**:
Specyfikacja nie wspomina o:
- Konfiguracji SMTP dla dev environment
- Mailpit (w `docker-compose.yml` w enterprise jest Mailpit)
- Jak testowaÄ‡ email flows lokalnie

**Sugestia**: DodaÄ‡ sekcjÄ™ Development:

```markdown
## 6. Development Setup

### 6.1 Email Testing (Mailpit)

For local development, emails are captured by Mailpit:

```yaml
# docker-compose.yml
mailpit:
  image: axllent/mailpit
  ports:
    - "1025:1025"  # SMTP
    - "8025:8025"  # Web UI
```

Access: http://localhost:8025

Backend config (.env):
```
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_FROM=noreply@synjar.local
```
```

---

#### Diagramy

**MISSING**:
- Brak sequence diagram dla login flow
- Brak sequence diagram dla token refresh
- Brak architecture diagram (frontend â†” backend interaction)

**Sugestia**: DodaÄ‡ diagramy:

```markdown
### 5.2 Login Flow Sequence

```
User â†’ Frontend: Submit email/password
Frontend â†’ Backend: POST /auth/login
Backend â†’ Database: Verify credentials
Backend â†’ Frontend: 200 OK + cookies (access_token, refresh_token)
Frontend â†’ Frontend: Store user in AuthContext
Frontend â†’ User: Redirect to /dashboard
```

### 5.3 Token Refresh Flow

```
Frontend â†’ Backend: GET /api/workspaces (with access_token)
Backend â†’ Frontend: 401 Unauthorized (token expired)
Frontend â†’ Backend: POST /auth/refresh (with refresh_token from cookie)
Backend â†’ Frontend: 200 OK + new cookies
Frontend â†’ Backend: Retry GET /api/workspaces (with new access_token)
Backend â†’ Frontend: 200 OK + workspaces
```
```

---

## 3. KompletnoÅ›Ä‡

### Ocena: NISKA (50%)

#### Edge Cases - BRAK

**NieobsÅ‚uÅ¼one sytuacje**:

1. **Concurrent token refresh**:
   - Co jeÅ›li 2 requesty dostanÄ… 401 jednoczeÅ›nie?
   - Spec pokazuje mutex (line 100-134 w api-client.ts), ale nie wyjaÅ›nia problem

2. **Expired refresh token**:
   - Co jeÅ›li refresh_token jest invalid/expired?
   - Spec: redirect do /login (line 222), ale brak info o clearowaniu state

3. **Network errors podczas login**:
   - Co jeÅ›li backend nie odpowiada?
   - Jak dÅ‚ugo czekaÄ‡? Retry?

4. **Session hijacking**:
   - Jak chroniÄ‡ tokeny?
   - CSRF protection? (SameSite=Strict wystarczy?)

5. **Multiple tabs**:
   - Co jeÅ›li user zaloguje siÄ™ w 2 tabkach?
   - Token refresh w jednej tabce - jak sync z drugÄ…?

**Sugestia**: DodaÄ‡ rozdziaÅ‚ Edge Cases:

```markdown
## 7. Edge Cases & Error Handling

### 7.1 Concurrent Token Refresh

**Problem**: Multiple API calls receiving 401 simultaneously.

**Solution**: Mutex pattern (implemented in api-client.ts lines 100-134)
- First 401 triggers refresh, subsequent wait
- After refresh, all retry with new token

### 7.2 Expired Refresh Token

**Symptom**: POST /auth/refresh returns 401

**Action**:
1. Clear all tokens
2. Clear AuthContext user state
3. Redirect to /login
4. Show message: "Session expired, please log in again"

### 7.3 Network Errors

**Symptoms**: fetch() throws, timeout, DNS failure

**Action**:
- Show user-friendly error: "Cannot connect to server"
- Retry button (don't auto-retry login - security)
- Check `navigator.onLine` for offline detection

### 7.4 CSRF Protection

**Implementation**: Cookies with `SameSite=Strict`
- No additional CSRF token needed (modern browsers)
- Require HTTPS in production (`Secure` flag)
```

---

#### Error Scenarios - CZÄ˜ÅšCIOWO

**Opisane w spec**:
- Login: "Invalid email or password" (line 271)
- Refresh failed: redirect to login (line 221-223)

**BRAK**:
- Network timeout
- 5xx server errors (backend down)
- Rate limiting (429 Too Many Requests)
- Validation errors (400 Bad Request)
- Conflict (409 - email exists)

**Backend validation** (z `apps/api/src/interfaces/dto/auth.dto.ts`):

```typescript
RegisterDto:
- password: min 12 chars, uppercase, lowercase, digit, special char
- email: valid email format

LoginDto:
- email: valid email
- password: any string
```

Frontend spec pokazuje tylko:

```typescript
const loginSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(1, 'Password is required'),
});
```

**MISSING**: Password strength validation on register (frontend powinien matchowaÄ‡ backend rules).

**Sugestia**: DodaÄ‡ RegisterForm validation:

```typescript
const registerSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string()
    .min(12, 'Password must be at least 12 characters')
    .regex(/[a-z]/, 'Must contain lowercase letter')
    .regex(/[A-Z]/, 'Must contain uppercase letter')
    .regex(/\d/, 'Must contain number')
    .regex(/[@$!%*?&]/, 'Must contain special character'),
  name: z.string().optional(),
});
```

---

#### Migration Steps - BRAK

**MISSING**:
- Jak migrowaÄ‡ existing sessions (jeÅ›li jakieÅ› byÅ‚y)?
- Czy trzeba wylogowaÄ‡ wszystkich userÃ³w?
- Backward compatibility z poprzednimi tokenami?

**Sugestia**: Dla MVP prawdopodobnie N/A, ale warto zaznaczyÄ‡:

```markdown
## 8. Migration & Deployment

**v1 MVP**: Fresh installation, no migration needed.

**Future versions**: If token format changes:
1. Invalidate all existing tokens (force re-login)
2. Update JWT_SECRET in .env (optional but recommended)
3. Notify users via email about security upgrade
```

---

## 4. CzytelnoÅ›Ä‡

### Ocena: DOBRA (80%)

**Zalety**:
- Jasny jÄ™zyk, zrozumiaÅ‚e przykÅ‚ady kodu
- Struktura chronologiczna (cel â†’ wymagania â†’ implementacja â†’ testy)
- Code snippets z komentarzami
- UI mockup (tekstowy, ale wystarczajÄ…cy)

**Problemy**:
- Brak linkÃ³w miÄ™dzy sekcjami (np. AuthContext reference w LoginForm)
- Brak glossary (co to jest "auto-refresh", "session management"?)
- Mieszanie implementacji frontend i backend (section 4.2 zakÅ‚ada backend, ale nie opisuje)
- Niekonsystentna terminologia:
  - "JWT w HTTP-only cookies (backend)" (line 48) vs localStorage w kodzie
  - "withCredentials: true" (line 197) - co to znaczy dla non-devs?

**Sugestia**:

```markdown
## Glossary

- **JWT (JSON Web Token)**: Signed token containing user info, used for authentication
- **Access Token**: Short-lived token (15min) for API requests
- **Refresh Token**: Long-lived token (7d) for getting new access tokens
- **HTTP-only Cookie**: Cookie that JavaScript cannot read (more secure than localStorage)
- **withCredentials**: Axios option to send cookies with cross-origin requests
- **Auto-refresh**: Automatic renewal of access token before expiration
```

---

## 5. ZgodnoÅ›Ä‡ z domenÄ… (Terminologia)

### Ocena: DOBRA (75%)

**Zgodne**:
- User, workspace, session - zgodne z community bounded contexts
- Authentication, authorization - standardowe terminy
- Login, register, logout - jednoznaczne

**Potencjalne niejasnoÅ›ci**:
- "Remember me" checkbox (line 37) - nie zaimplementowane, nie opisane
- "Forgot Password" (line 31) - wymienione ale nie opisane (v2)
- "Terms of service checkbox" (line 44) - nie ma endpoint dla ToS

**MISSING**: Link do ecosystem.md lub domain model dokumentacji.

**Sugestia**: DodaÄ‡ na poczÄ…tku specyfikacji:

```markdown
## Related Documentation

- [Community Ecosystem](../ecosystem.md) - Bounded Contexts
- [Security Guidelines](../security/SECURITY_GUIDELINES.md) - Auth best practices
- [Backend Auth Module](../../apps/api/src/application/auth/README.md) - Implementation
```

---

## 6. CRITICAL Findings

### ğŸ”´ CRITICAL - Backend API mismatch

**Problem**:
Specyfikacja zakÅ‚ada Å¼e backend uÅ¼ywa AuthResponseDto z tokenami w body (line 148, 154):

```typescript
const response = await apiClient.post('/auth/login', { email, password });
setUser(response.data.user);  // Assumes response.data.user exists
```

**Rzeczywisty backend** (auth.controller.ts):

```typescript
return { message: 'Login successful', user: result.user };
// Tokeny sÄ… w COOKIES, nie w response body
```

**Impact**:
- Frontend spec pokazuje localStorage (line 48 w authApi.ts)
- Backend uÅ¼ywa HTTP-only cookies
- To jest FUNDAMENTALNE security decision - musi byÄ‡ spÃ³jne!

**Jak naprawiÄ‡ spec**:

```markdown
### 4.2 Auth Context

**IMPORTANT**: Backend uses HTTP-only cookies for token storage (more secure than localStorage).

Frontend does NOT need to manually store tokens - they are automatically sent with requests via cookies.

```typescript
const login = async (email: string, password: string) => {
  // Backend sets cookies automatically in response
  const response = await apiClient.post('/auth/login', { email, password });

  // Response contains only user data (no tokens)
  setUser(response.data.user);
};
```

API Client configuration:

```typescript
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_URL || '/api/v1',
  withCredentials: true, // CRITICAL: Send cookies with requests
});
```
```

---

### ğŸ”´ CRITICAL - Missing GET /auth/me endpoint

**Problem**:
Spec uÅ¼ywa `/auth/me` do session check (line 136):

```typescript
const response = await apiClient.get('/auth/me');
setUser(response.data);
```

**Backend**: Ten endpoint NIE ISTNIEJE (sprawdzone grep w auth.controller.ts).

**Impact**:
- Frontend nie moÅ¼e zweryfikowaÄ‡ czy user jest zalogowany po refreshu strony
- AuthProvider.checkSession() bÄ™dzie fail

**Jak naprawiÄ‡**:

Opcja 1 - DodaÄ‡ endpoint do backendu:

```typescript
// apps/api/src/interfaces/http/auth.controller.ts

@Get('me')
@UseGuards(JwtAuthGuard)
@ApiOperation({ summary: 'Get current user' })
@ApiResponse({ status: 200, type: UserDto })
async getCurrentUser(@Request() req): Promise<UserDto> {
  return {
    id: req.user.id,
    email: req.user.email,
    name: req.user.name,
  };
}
```

Opcja 2 - Alternatywna strategia w spec (jeÅ›li backend nie chce endpoint):

```typescript
// Check session by calling any authenticated endpoint
const checkSession = async () => {
  try {
    // Use existing endpoint that requires auth
    const response = await apiClient.get('/workspaces');
    // If 200, user is authenticated - fetch user from first workspace or store in cookie
    setIsAuthenticated(true);
  } catch {
    setIsAuthenticated(false);
  }
};
```

Ale to NIE jest dobre rozwiÄ…zanie - lepiej dodaÄ‡ `/auth/me`.

---

### ğŸ”´ CRITICAL - Zero testÃ³w (naruszenie TDD)

**Problem**:
CLAUDE.md wymaga:
```
"Always write tests first (TDD). Stub > mock. Don't test implementation, test behavior."
```

Specyfikacja ma rozdziaÅ‚ "6. Testy" (line 449-493) z przykÅ‚adami, ale:
- Brak testÃ³w w Definition of Done checklist (line 509 "Unit testy dla formularzy" - vague)
- Brak konkretnych test cases (ilu testÃ³w? jakie scenariusze?)
- Brak E2E test scenarios

**Rzeczywisty kod**: 1 dummy test w `App.test.tsx`:

```typescript
it('should be defined', () => {
  expect(true).toBe(true);
});
```

**Jak naprawiÄ‡ spec**:

```markdown
## 6. Test Strategy

### 6.1 Unit Tests (Vitest + React Testing Library)

**LoginForm.test.tsx**:
- [x] Renders login form with email and password fields
- [x] Shows validation errors for empty fields
- [x] Shows validation errors for invalid email format
- [x] Calls login() on valid submit
- [x] Shows error message when login fails (401)
- [x] Shows error message on network error
- [x] Disables submit button while loading
- [x] Redirects to /dashboard on successful login

**AuthProvider.test.tsx**:
- [x] Provides isAuthenticated=false initially
- [x] Checks session on mount (calls GET /auth/me)
- [x] Sets user on successful session check
- [x] login() updates user state
- [x] logout() clears user state
- [x] Shows loading state during session check

**ProtectedRoute.test.tsx**:
- [x] Redirects to /login when not authenticated
- [x] Renders children when authenticated
- [x] Shows loading spinner while checking session
- [x] Preserves intended URL in location state

### 6.2 Integration Tests

**Login flow E2E**:
- [x] User enters valid credentials â†’ logged in
- [x] User enters invalid credentials â†’ error shown
- [x] User navigates to /dashboard without login â†’ redirected to /login
- [x] User logs in from redirect â†’ redirected back to /dashboard

**Token refresh**:
- [x] Access token expires â†’ auto-refresh â†’ request succeeds
- [x] Refresh token expired â†’ redirect to login

### 6.3 Test Coverage Target

Minimum 80% coverage for:
- features/auth/**
- app/router/ProtectedRoute.tsx

### 6.4 Definition of Done

- [x] LoginForm: 8 unit tests passing
- [x] AuthProvider: 6 unit tests passing
- [x] ProtectedRoute: 4 unit tests passing
- [x] E2E: Login flow test passing
- [x] Coverage: >80% for auth module
```

---

## 7. BRAKI w specyfikacji

### ğŸŸ  HIGH - Brak Register Page implementation

**Problem**:
- Spec wymienia RegisterPage w section 2.1 (line 31)
- Spec ma RegisterForm code example (brak, ale zaÅ‚oÅ¼one)
- Spec ma UI mockup tylko dla Login (line 387-417)
- Definition of Done: "RegisterPage + RegisterForm" (line 505)

**Rzeczywisty frontend**: Brak `Register.tsx` w `apps/web/src/features/auth/`.

**Jak naprawiÄ‡ spec**: DodaÄ‡ RegisterForm mockup i code:

```markdown
### 4.7 Register Form

```typescript
const registerSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string()
    .min(12, 'Password must be at least 12 characters')
    .regex(/[a-z]/, 'Must contain lowercase')
    .regex(/[A-Z]/, 'Must contain uppercase')
    .regex(/\d/, 'Must contain number')
    .regex(/[@$!%*?&]/, 'Must contain special character'),
  confirmPassword: z.string(),
  name: z.string().optional(),
  termsAccepted: z.boolean(),
}).refine(data => data.password === data.confirmPassword, {
  message: "Passwords don't match",
  path: ['confirmPassword'],
}).refine(data => data.termsAccepted, {
  message: "You must accept terms of service",
  path: ['termsAccepted'],
});

export function RegisterForm() {
  // Similar to LoginForm but with additional fields
}
```

### 5.3 Register Page Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Synjar                        â”‚
â”‚                                         â”‚
â”‚  Create your account                    â”‚
â”‚                                         â”‚
â”‚  Email                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ you@example.com         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚  Name (optional)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ John Doe                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚  Password                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  Must be 12+ chars, contain A-Z, a-z,   â”‚
â”‚  0-9, and @$!%*?&                       â”‚
â”‚                                         â”‚
â”‚  Confirm Password                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚  â˜‘ I accept Terms of Service            â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚      Create account     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚  Already have an account? Sign in       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
```

---

### ğŸŸ  HIGH - Brak workspace creation po register

**Problem**: Jak opisane w sekcji 2, brak definicji co siÄ™ dzieje z workspace po rejestracji.

**Pytania**:
1. Backend tworzy default workspace?
2. Frontend musi wywoÅ‚aÄ‡ POST /workspaces?
3. Redirect do /dashboard czy /workspaces/new?

**Sugestia**: DodaÄ‡ flow diagram i wyjaÅ›nienie.

---

### ğŸŸ¡ MEDIUM - Brak HTTPS enforcement w spec

**Problem**:
Spec nie wymienia HTTPS jako requirement, mimo Å¼e:
- HTTP-only cookies wymagajÄ… Secure flag
- Credentials przesyÅ‚ane plain text bez HTTPS

**Backend uÅ¼ywa**:

```typescript
secure: process.env.NODE_ENV === 'production'
```

Ale brak info jak enforce HTTPS.

**Sugestia**: DodaÄ‡ deployment notes:

```markdown
## 9. Production Deployment

### 9.1 HTTPS Requirement

**CRITICAL**: Application MUST run on HTTPS in production.

Reasons:
- `Secure` flag on cookies requires HTTPS
- Credentials transmitted in plain text over HTTP
- Modern browsers block cookies on insecure origins

**Enforcement**:
```nginx
# nginx.conf
server {
    listen 80;
    server_name synjar.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    # ...
}
```

**Development**: Use `https://localhost:3100` with self-signed cert (Vite plugin).
```

---

### ğŸŸ¡ MEDIUM - Brak ADR dla frontend stack

**Problem**:
Spec uÅ¼ywa:
- React 19 (nowa wersja, wydana 2024-12-05)
- Vite 6 (nowa, wydana 2024-11)
- React Router 7 (nowa, wydana 2024-11)
- Tailwind CSS 4 (alpha/beta)

To sÄ… bleeding-edge technologie. Powinna byÄ‡ ADR wyjaÅ›niajÄ…ca:
- Dlaczego React 19 (concurrent features? server components?)
- Dlaczego Vite 6 vs Next.js?
- Trade-offs (stabilnoÅ›Ä‡ vs features)

**Brak**: `docs/adr/ADR-YYYY-MM-DD-frontend-stack.md`

**Sugestia**: UtworzyÄ‡ ADR:

```markdown
# ADR-2025-12-24: Frontend Stack Selection

## Status
Accepted

## Context
Need to choose frontend stack for Synjar Community (self-hosted RAG).

Options:
1. Next.js (SSR, opinionated, larger bundle)
2. Vite + React (SPA, flexible, smaller bundle)
3. Remix (SSR, file-based routing)

## Decision
Vite 6 + React 19 + React Router 7 + Tailwind CSS 4

## Rationale

**Why Vite**:
- Fast HMR (instant feedback during dev)
- Smaller production bundle (vs Next.js App Router)
- No vendor lock-in (vs Next.js deployment)
- Self-hosted focus (no Vercel dependency)

**Why React 19**:
- Latest stable (released 2024-12-05)
- Improved concurrent rendering
- Better TypeScript support
- Actions for forms (reduce boilerplate)

**Why React Router 7**:
- File-based routing optional (we use code-based)
- Loader pattern for data fetching
- Better TypeScript inference
- Actively maintained

**Why Tailwind CSS 4**:
- Vite plugin (faster than PostCSS)
- Smaller CSS output
- Better IntelliSense
- Oxide engine (Rust-based, faster)

## Consequences

**Positive**:
- Fast development experience
- Smaller bundle size
- Full control over deployment
- Modern features (React 19, Tailwind 4)

**Negative**:
- Bleeding-edge versions (potential bugs)
- Less community examples (newer stack)
- No built-in SSR (SPA only for MVP)

## Alternatives Rejected

**Next.js**: Too opinionated, Vercel lock-in, heavier bundle
**Remix**: Less mature, smaller ecosystem
**Svelte/Vue**: Team expertise in React
```

---

## 8. Sugestie ulepszeÅ„ dokumentacji

### ğŸ’¡ Progressive Disclosure

**Problem**: Specyfikacja ma 529 linii - doÅ›Ä‡ dÅ‚uga.

**Sugestia**: RozwaÅ¼yÄ‡ podziaÅ‚ na:

```
docs/specifications/SPEC-011-frontend-auth/
â”œâ”€â”€ README.md              # Cel, scope, DoD, links
â”œâ”€â”€ api-contracts.md       # Backend API specification
â”œâ”€â”€ implementation.md      # Code examples (AuthContext, forms)
â”œâ”€â”€ ui-mockups.md          # UI designs
â”œâ”€â”€ testing.md             # Test strategy, examples
â””â”€â”€ deployment.md          # Production notes, HTTPS
```

GÅ‚Ã³wny `SPEC-011-frontend-auth.md` byÅ‚by indeksem z linkami.

---

### ğŸ’¡ DodaÄ‡ przykÅ‚ady bÅ‚Ä™dÃ³w

**Problem**: Spec pokazuje happy path, ale niewiele error handling examples.

**Sugestia**: DodaÄ‡ sekcjÄ™ z screenshots/mockups bÅ‚Ä™dÃ³w:

```markdown
### 5.4 Error States Mockups

#### Invalid Credentials
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Invalid email or password      â”‚
â”‚                                   â”‚
â”‚ Please check your credentials     â”‚
â”‚ and try again.                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Network Error
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Œ Cannot connect to server       â”‚
â”‚                                   â”‚
â”‚ Please check your internet        â”‚
â”‚ connection and try again.         â”‚
â”‚                                   â”‚
â”‚ [Retry]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
```

---

### ğŸ’¡ Link do security best practices

**Problem**: Spec implementuje auth, ale nie linkuje do `docs/security/SECURITY_GUIDELINES.md`.

**Sugestia**: DodaÄ‡ na poczÄ…tku:

```markdown
## Security Considerations

**IMPORTANT**: Read [Security Guidelines](../security/SECURITY_GUIDELINES.md) before implementation.

Key points:
- Use HTTP-only cookies (NOT localStorage) for tokens
- Enforce HTTPS in production
- Validate input on both client and server
- Rate limit login attempts (backend)
- Log authentication events (audit trail)

See also: [Code Review Security Checklist](../security/CODE_REVIEW_SECURITY_CHECKLIST.md)
```

---

### ğŸ’¡ DodaÄ‡ timeline/milestones

**Problem**: Definition of Done nie ma timeframeu.

**Sugestia**:

```markdown
## 10. Timeline

**Sprint 1 (Days 1-3)**:
- [ ] Project setup (Vite + React + TypeScript)
- [ ] API client + AuthContext
- [ ] LoginPage + tests

**Sprint 2 (Days 4-5)**:
- [ ] RegisterPage + tests
- [ ] ProtectedRoute + tests
- [ ] E2E tests

**Sprint 3 (Day 6)**:
- [ ] UI polish (loading states, error messages)
- [ ] Documentation update (README)
- [ ] Code review

**Total**: 6 days (1 developer)
```

---

## 9. Wymagane aktualizacje dokumentacji

### ğŸ“ Po zrealizowaniu SPEC-011

| Dokument | Co zaktualizowaÄ‡ | Priorytet |
|----------|------------------|-----------|
| `docs/ecosystem.md` | DodaÄ‡ Frontend (Web) do Platform Layer jako bounded context "User Interface".<br>OpisaÄ‡ komunikacjÄ™ frontend â†” backend (REST API). | HIGH |
| `docs/adr/ADR-frontend-stack.md` | UtworzyÄ‡ ADR dla wyboru React 19 + Vite 6 + Tailwind 4.<br>WyjaÅ›niÄ‡ trade-offs (bleeding-edge vs stability). | HIGH |
| `community/apps/web/README.md` | UtworzyÄ‡ README z:<br>- Architektura (bounded contexts)<br>- Development setup<br>- Testing strategy<br>- Deployment notes | HIGH |
| `docs/security/SECURITY_GUIDELINES.md` | DodaÄ‡ sekcjÄ™ Frontend Security:<br>- Token storage (cookies vs localStorage)<br>- HTTPS enforcement<br>- CSRF protection<br>- XSS prevention (React default) | MEDIUM |
| `docs/specifications/SPEC-011-frontend-auth.md` | UzupeÅ‚niÄ‡ braki opisane w tym raporcie:<br>- Backend API contracts<br>- GET /auth/me endpoint requirement<br>- Workspace creation flow<br>- Error scenarios<br>- Edge cases | CRITICAL |
| `community/docs/README.md` | ZaktualizowaÄ‡ status SPEC-011 z "Draft" na "Completed" (gdy zrealizowane).<br>DodaÄ‡ link do implementation notes. | LOW |

---

## 10. ZgodnoÅ›Ä‡ z CLAUDE.md

### âŒ Naruszenia

1. **TDD requirement**:
   ```
   CLAUDE.md: "Always write tests first (TDD)"
   Spec: Ma rozdziaÅ‚ "Testy", ale brak testÃ³w w implementacji
   ```

2. **Clean Architecture**:
   ```
   CLAUDE.md: "Use: DDD, SOLID, DI, Clean Code, Clean Architecture"
   Spec: Kod pokazuje logikÄ™ w komponentach (Anemic Architecture)
   ```

3. **Documentation**:
   ```
   CLAUDE.md: "Przeczytaj zawsze plik README.md w product, package lub platform"
   Status: Brak apps/web/README.md
   ```

4. **Specifications vs Documentation**:
   ```
   spec-vs-docs.md: "Specyfikacja zmienia system, czyli powinna koÅ„czyÄ‡ siÄ™ rÃ³wnieÅ¼ zmianÄ… dokumentacji"
   Status: Brak checklisty aktualizacji docs w DoD
   ```

### Sugestie naprawy

**Definition of Done** powinien zawieraÄ‡:

```markdown
## 7. Definition of Done

### Implementation
- [x] Project setup (Vite + React + TypeScript)
- [x] Tailwind CSS configuration
- [x] API client z credentials i interceptors
- [x] AuthContext + useAuth hook
- [x] LoginPage + LoginForm
- [x] RegisterPage + RegisterForm
- [x] ProtectedRoute component
- [x] Router configuration

### Testing (TDD REQUIREMENT)
- [x] LoginForm: 8 unit tests passing
- [x] RegisterForm: 6 unit tests passing
- [x] AuthProvider: 6 unit tests passing
- [x] ProtectedRoute: 4 unit tests passing
- [x] E2E: Login flow test passing
- [x] Coverage: >80% for features/auth

### Documentation (MANDATORY)
- [x] Update docs/ecosystem.md (add Frontend bounded context)
- [x] Create docs/adr/ADR-frontend-stack.md
- [x] Create apps/web/README.md
- [x] Update docs/security/SECURITY_GUIDELINES.md (frontend security)
- [x] Mark SPEC-011 as "Completed" in docs/README.md

### Code Review
- [x] Architecture review (Clean Architecture layers)
- [x] Security review (HTTPS, token storage)
- [x] Code quality review (SOLID, DRY, naming)
```

---

## Podsumowanie

### Ocena ogÃ³lna: 60% - NEEDS IMPROVEMENT

**Mocne strony**:
- Jasno zdefiniowany cel biznesowy (MVP auth)
- SzczegÃ³Å‚owe przykÅ‚ady kodu (AuthContext, API client)
- UI mockups (Login page)
- Stack dobrze dobrany (React 19, Vite 6)

**Krytyczne braki**:
- âŒ Brak backend API specification (contracts, error codes)
- âŒ Brak GET /auth/me endpoint definition (uÅ¼ywany w kodzie!)
- âŒ NiezgodnoÅ›Ä‡ token storage (spec: localStorage, backend: cookies)
- âŒ Brak workspace creation flow
- âŒ Brak testÃ³w (naruszenie TDD)
- âŒ Brak Clean Architecture (logika w komponentach)

**Wysokie braki**:
- âš ï¸ Brak Register Page implementation details
- âš ï¸ Brak email templates / Mailpit setup
- âš ï¸ Brak edge cases i error scenarios
- âš ï¸ Brak HTTPS enforcement notes
- âš ï¸ Brak ADR dla frontend stack

**Åšrednie braki**:
- Brak diagramÃ³w (sequence, architecture)
- Brak migration plan
- Brak glossary
- Brak README.md w DoD

### Rekomendacje

**Priorytet P0 (przed implementacjÄ…)**:
1. DodaÄ‡ Backend API Contracts section (request/response schemas)
2. ZdefiniowaÄ‡ GET /auth/me endpoint lub alternatywnÄ… strategiÄ™
3. RozwiÄ…zaÄ‡ konflikt token storage (cookies vs localStorage)
4. DodaÄ‡ workspace creation flow
5. DodaÄ‡ Test Strategy z konkretnymi test cases
6. DodaÄ‡ Documentation Update checklist do DoD

**Priorytet P1 (podczas implementacji)**:
7. UtworzyÄ‡ ADR dla frontend stack
8. DodaÄ‡ Edge Cases section
9. DodaÄ‡ Error Scenarios z mockups
10. DodaÄ‡ HTTPS enforcement notes

**Priorytet P2 (przed merge)**:
11. UtworzyÄ‡ apps/web/README.md
12. ZaktualizowaÄ‡ docs/ecosystem.md
13. DodaÄ‡ sequence diagrams
14. DodaÄ‡ glossary

---

**NastÄ™pne kroki**:
1. UzupeÅ‚niÄ‡ specyfikacjÄ™ wedÅ‚ug P0 findings
2. Review przez zespÃ³Å‚ (backend + frontend)
3. UtworzyÄ‡ ADR-frontend-stack.md
4. RozpoczÄ…Ä‡ implementacjÄ™ z TDD approach
5. Update docs po zakoÅ„czeniu (ecosystem.md, README.md)

---

**Raport wygenerowany**: 2025-12-25 21:00
**Autor**: Documentation Reviewer Agent
**Wersja specyfikacji**: Draft (2025-12-24)
