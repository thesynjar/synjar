# ADR-2025-12-25: Signed URLs for Public File Access

## Status

Accepted

## Context

Public Links API needs to provide access to PDF files (original documents) by external systems without authentication.

Options considered:
1. **Public ACL on B2 bucket** - files publicly accessible without time limits
2. **Signed URLs** - temporary URLs with built-in authorization (AWS S3 pre-signed URLs)
3. **Proxy endpoint** - API serves files through its own endpoint

## Decision

We use **Signed URLs** generated by AWS SDK (@aws-sdk/s3-request-presigner).

### Implementation:
- Backend generates signed URL for each API request
- Default expiration: 3600s (1 hour)
- Uses existing IStorageService.getSignedUrl() interface

## Consequences

### Positive:
- **Security:** Files are not exposed publicly forever
- **Access Control:** Each file access requires valid public link token
- **Revocation:** Deleting public link immediately prevents new signed URL generation
- **Audit:** Possibility to log file access in the future

### Negative:
- **Performance:** Additional latency for signed URL generation (~10-50ms per file)
- **Expiration:** External system must download file within 1h
- **Caching:** Harder to cache API responses (URL changes)

### Trade-offs:
- We choose security over small performance overhead
- 1h expiration is a compromise between security and user experience

## Alternatives Rejected

### Public ACL:
- Files publicly accessible without control
- Cannot revoke access after deleting public link
- No audit trail

### Proxy endpoint:
- Backend must stream files (high load)
- No CDN utilization from Backblaze
- Full control over access (positive)
